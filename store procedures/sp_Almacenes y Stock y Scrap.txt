CREATE PROCEDURE sp_IngresoMercaderia
    @id_producto INT,
    @id_usuario INT,
    @lote VARCHAR(50),
    @cantidad INT,
    @stockMinimo INT,
    @stockIdeal INT,
    @stockMaximo INT,
    @tipoStock VARCHAR(20),
    @puntoReposicion INT,
    @fechaVencimiento DATE,
    @estadoHabilitaciones VARCHAR(50),
    @id_movimientosStock INT
AS
BEGIN
    INSERT INTO Stock (id_producto, id_usuario, lote, stock, stockMinimo, stockIdeal, stockMaximo, tipoStock, puntoReposicion, fechaVencimiento, estadoHabilitaciones, id_movimientosStock)
    VALUES (@id_producto, @id_usuario, @lote, @cantidad, @stockMinimo, @stockIdeal, @stockMaximo, @tipoStock, @puntoReposicion, @fechaVencimiento, @estadoHabilitaciones, @id_movimientosStock)
END
GO

CREATE PROCEDURE sp_ReporteMovimientosStock
    @fechaDesde DATE,
    @fechaHasta DATE
AS
BEGIN
    SELECT ms.id_movimientosStock,
           ms.fecha,
           u.nombre AS Usuario,
           p.nombre AS Producto,
           ms.tipoMovimiento,
           ms.cantidad
    FROM MovimientosStock ms
    INNER JOIN Usuarios u ON ms.id_usuario = u.id_usuario
    INNER JOIN Productos p ON ms.id_producto = p.id_producto
    WHERE ms.fecha BETWEEN @fechaDesde AND @fechaHasta
END
GO

CREATE PROCEDURE sp_MoverStockAScrap
    @id_producto INT,
    @cantidad INT,
    @id_usuario INT,
    @id_motivoScrap INT
AS
BEGIN
    INSERT INTO ScrapProducto (id_producto, cantidad, id_usuario, id_motivoScrap)
    VALUES (@id_producto, @cantidad, @id_usuario, @id_motivoScrap)

    UPDATE Stock
    SET stock = stock - @cantidad
    WHERE id_producto = @id_producto
END
GO

CREATE PROCEDURE sp_ReporteScrap
    @fechaDesde DATE,
    @fechaHasta DATE
AS
BEGIN
    SELECT sp.id_scrapProducto,
           sp.fecha,
           u.nombre AS Usuario,
           p.nombre AS Producto,
           ms.descripcion AS Motivo,
           sp.cantidad
    FROM ScrapProducto sp
    INNER JOIN Usuarios u ON sp.id_usuario = u.id_usuario
    INNER JOIN Productos p ON sp.id_producto = p.id_producto
    INNER JOIN MotivoScrap ms ON sp.id_motivoScrap = ms.id_motivoScrap
    WHERE sp.fecha BETWEEN @fechaDesde AND @fechaHasta
END
GO
