CREATE PROCEDURE sp_AgregarProducto
    @codigo VARCHAR(50),
    @codBarras VARCHAR(50),
    @nombre VARCHAR(100),
    @descripcion VARCHAR(255),
    @id_marca INT,
    @precioCompra DECIMAL(18,2),
    @precioVenta DECIMAL(18,2),
    @estado VARCHAR(50),
    @ubicacion VARCHAR(100),
    @habilitado BIT,
    @id_categoria INT
AS
BEGIN
    INSERT INTO Productos (codigo, codBarras, nombre, descripcion, id_marca, precioCompra, precioVenta, estado, ubicacion, habilitado, id_categoria)
    VALUES (@codigo, @codBarras, @nombre, @descripcion, @id_marca, @precioCompra, @precioVenta, @estado, @ubicacion, @habilitado, @id_categoria)
END
GO


CREATE PROCEDURE sp_ModificarProducto
    @id_producto INT,
    @codigo VARCHAR(50),
    @codBarras VARCHAR(50),
    @nombre VARCHAR(100),
    @descripcion VARCHAR(255),
    @id_marca INT,
    @precioCompra DECIMAL(18,2),
    @precioVenta DECIMAL(18,2),
    @estado VARCHAR(50),
    @ubicacion VARCHAR(100),
    @habilitado BIT,
    @id_categoria INT
AS
BEGIN
    UPDATE Productos
    SET codigo = @codigo,
        codBarras = @codBarras,
        nombre = @nombre,
        descripcion = @descripcion,
        id_marca = @id_marca,
        precioCompra = @precioCompra,
        precioVenta = @precioVenta,
        estado = @estado,
        ubicacion = @ubicacion,
        habilitado = @habilitado,
        id_categoria = @id_categoria
    WHERE id_producto = @id_producto
END
GO


CREATE PROCEDURE sp_EliminarProducto
    @id_producto INT
AS
BEGIN
    DELETE FROM Productos WHERE id_producto = @id_producto
END
GO


CREATE PROCEDURE sp_ObtenerProductos
AS
BEGIN
    SELECT p.id_producto, p.codigo, p.nombre, p.descripcion, m.nombre AS Marca, c.categoria AS Categoria,
           p.precioCompra, p.precioVenta, p.estado, p.ubicacion, p.habilitado
    FROM Productos p
    LEFT JOIN Marcas m ON p.id_marca = m.id_marca
    LEFT JOIN CategoriasProducto c ON p.id_categoria = c.id_categoria
END
GO


CREATE PROCEDURE sp_BuscarProducto
    @busqueda VARCHAR(100)
AS
BEGIN
    SELECT p.*, m.nombre AS Marca, c.categoria AS Categoria
    FROM Productos p
    LEFT JOIN Marcas m ON p.id_marca = m.id_marca
    LEFT JOIN CategoriasProducto c ON p.id_categoria = c.id_categoria
    WHERE p.nombre LIKE '%' + @busqueda + '%'
       OR p.codigo LIKE '%' + @busqueda + '%'
       OR m.nombre LIKE '%' + @busqueda + '%'
       OR c.categoria LIKE '%' + @busqueda + '%'
END
GO


CREATE PROCEDURE sp_ProductosHabilitados
AS
BEGIN
    SELECT * FROM Productos WHERE habilitado = 1
END
GO


CREATE PROCEDURE sp_ProductosPorCategoria
    @id_categoria INT
AS
BEGIN
    SELECT * FROM Productos WHERE id_categoria = @id_categoria
END
GO


CREATE PROCEDURE sp_ProductosPorMarca
    @id_marca INT
AS
BEGIN
    SELECT * FROM Productos WHERE id_marca = @id_marca
END
GO


CREATE PROCEDURE sp_ConsultarProductoPorNombre
    @nombre VARCHAR(100)
AS
BEGIN
    SELECT p.*, m.nombre AS Marca, c.categoria AS Categoria
    FROM Productos p
    LEFT JOIN Marcas m ON p.id_marca = m.id_marca
    LEFT JOIN CategoriasProducto c ON p.id_categoria = c.id_categoria
    WHERE p.nombre LIKE '%' + @nombre + '%'
END
GO


CREATE PROCEDURE sp_ConsultarProductoPorCodigo
    @codigo VARCHAR(50)
AS
BEGIN
    SELECT p.*, m.nombre AS Marca, c.categoria AS Categoria
    FROM Productos p
    LEFT JOIN Marcas m ON p.id_marca = m.id_marca
    LEFT JOIN CategoriasProducto c ON p.id_categoria = c.id_categoria
    WHERE p.codigo = @codigo
END
GO