@page "/configuracion"
@inject Microsoft.JSInterop.IJSRuntime JS
<PageHeader Title="ConfiguraciÃ³n" Subtitle="Preferencias de apariencia y ajustes" />

<section class="panel">
	<div class="panel-header">Apariencia</div>
	<div class="config-appearance">
		<div class="config-row">
			<label>Tema:</label>
			<select class="input" @bind="theme">
				<option value="auto">Auto</option>
				<option value="light">Claro</option>
				<option value="dark">Oscuro</option>
			</select>
		</div>
		<div class="config-row config-accent">
			<label>Color de acento:</label>
			<input class="input" type="color" @bind="accent" />
		</div>
		<div class="config-actions">
			<button class="btn btn-primary" @onclick="Aplicar">Aplicar</button>
		</div>
	</div>
	<p style="margin-top:.5rem; color:var(--neutral-foreground-rest)">Los cambios se guardan en este navegador y se aplican de inmediato.</p>
</section>

<section class="panel">
	<div class="panel-header">Notificaciones</div>
	<label class="fancy-checkbox">
		<input type="checkbox" @bind="notifEmail" />
		<span class="fancy-check" aria-hidden="true"></span>
		<span class="fancy-label">Email</span>
	</label>
	<label class="fancy-checkbox">
		<input type="checkbox" @bind="notifToast" />
		<span class="fancy-check" aria-hidden="true"></span>
		<span class="fancy-label">Toasts en app</span>
	</label>
</section>

@code {
    private string theme = "auto";
    private string accent = "#6d28d9"; // violeta por defecto
	private bool notifEmail = true;
	private bool notifToast = true;

	protected override async Task OnInitializedAsync()
	{
		// Cargar valores persistidos si existen
		var savedTheme = await JS.InvokeAsync<string?>("app.getLocal", "theme");
		var savedAccent = await JS.InvokeAsync<string?>("app.getLocal", "accent");
		if (!string.IsNullOrWhiteSpace(savedTheme)) theme = savedTheme!;
		if (!string.IsNullOrWhiteSpace(savedAccent)) accent = savedAccent!;
		await ApplyTheme();
	}

	private async Task Aplicar()
	{
		await ApplyTheme();
	}

	private async Task ApplyTheme()
	{
		// Persistir y aplicar al DOM
		await JS.InvokeVoidAsync("app.setLocal", "theme", theme);
		await JS.InvokeVoidAsync("app.setLocal", "accent", accent);
		await JS.InvokeVoidAsync("app.setTheme", theme);
		await JS.InvokeVoidAsync("app.setAccent", accent);
	}
}
